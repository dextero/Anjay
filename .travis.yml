# Copyright 2017 AVSystem <avsystem@avsystem.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

language: c

sudo: required

dist: trusty

env:
  global:
  # COVERITY_SCAN_TOKEN
  - secure: Fb3dnZ9jvl031FrjgJIuZKQTxZIIHbwRWCcTIIRpHOSzGYv5P1rcm4Z5WZ3WsTNi222UP3BFui0zzRu4aDHCpDtYQ3J/ZTV/+Cp+DJnAcOsr3y6OjE+e4PmQb78HJaquog1ot2ctfnSOHuNQAbbUqKg18i7TCFCqjG8ZTqug1v5YfV5RQaVZ8hlCQyPsHo6vSNQW4iTVn3TKTLxY+5m4VPoGN2IWcz52LwmE53dnOEn8TdB0iPbyymMYD4RX1awIjEG/v9yBZ9h0Vc1C75RrkO2rxUsILzKUO3Z9f6RTcZIUMU3OOfOS4z/ZpTurc/Z0293YZPB+hxYy0EISAoRf3v9ZvHNyIhYKriQSt8IaLHM9fA3pnG5T2d0eRRzIMActnqVeRq0fvZ4nuw4i3e88HQwUTwcYMgDRRX+OIrTwOLjEv2TB0aW3ZgsksPnhpGzurEuvJv7TH2KwpChm/sorHW5o70h4mKZ9SE+XDNQ+UYPoFyJprUd9QtJoM58fW/6cdnDIpqtGSenec4YaHqekjXHnPneoYSpgyy+TevH/5ZbaIDhlQCZB2ZuyDX0/RbBKOG4NFMiMMCe0UJsZYT9pofeytPLqWFWUV+ASBS1rQrZEJVXhmR3arNZARQblBP4PLBabUrEeVAhq2cvhdFZE2u91HhqdQZS/OYIjQKLiABY=
  # COVERITY_EMAIL
  - secure: JmU5yh31hXUFZmZ0q47zwu3NtAogi6jhE1UDravMSMDaAtLvx9KAehSEL0j02PPRgphUnl4fEZS1C9rJXFwrg2UQnNm+DHZs15rM4PMZGE9eqJzlS+QizMUSI/fTvn/UI0CYJ524OhEQZywy1sevnRqaWcUoqQo0ekqt0rT8b2oYKovk82XB3xuesesifftJQXYxCbMGqg3jUK96EDyTR/aSmJDHi7jLIxMauG8yPnhLORlxPBhrNzPI89vyItphLCDWcROzCWd2A95Y0ePfbFJn+xP6/KxVL2rbA6z5Op9df2yfu3FyIOJPjANFJxC5XvGy5U4FgpHcWYc7fYNOkSgZo27tzImTl87zEi4LWy/7+YK4N8xAt0TuTXJz2l9FSS+4NT9wayQu6ROdNO6mIRagCIyr8ORVrMSXDlXow2VGDiGtDz+8svU3ARhZ1ofdZohkiacXGzi+IDRyefryW1iM6/h6zkYMVHMpIuMYNLNbGp+LLNjoutr8mTyFTBatLj7eWU1YCZ9zCqS5EdKV3EnKaEdQv43dKowgksXnY3Rp4qlEWPG7foekQyGMFsaozjfIqjY/cpDVyMuSa913fqyIYGvQogm1Ow0BlgRBlAjGx8YDHxa4n3QtOrf4XxqL25/MmdBRg2Kde1sVc4DMHHrBVcy9JUlmQnVT25dWGOI=

osx_image: xcode8.2

services:
  - docker

matrix:
  include:
  - stage: test
    os: osx
    env: DEVCONFIG_FLAGS=--with-asan

  - stage: test
    os: linux
    env: ANJAY_CC=gcc-4.7
         ANJAY_CXX=g++
         PYMBEDTLS_CC=gcc
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=gcc-4.8
         ANJAY_CXX=g++
         PYMBEDTLS_CC=gcc
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=gcc-4.9
         ANJAY_CXX=g++
         PYMBEDTLS_CC=gcc
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=gcc-5
         ANJAY_CXX=g++-5
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=clang-3.5
         ANJAY_CXX=clang++-3.5
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=clang-3.6
         ANJAY_CXX=clang++-3.6
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=clang-3.7
         ANJAY_CXX=clang++-3.7
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=clang-3.8
         ANJAY_CXX=clang++-3.8
         DEVCONFIG_FLAGS=--with-valgrind
         DOCKER_IMAGE=ubuntu-16.04

  - stage: test
    os: linux
    env: ANJAY_CC=gcc
         ANJAY_CXX=g++
         DEVCONFIG_FLAGS=--with-valgrind -DPython_ADDITIONAL_VERSIONS=3.5
         DOCKER_IMAGE=centos7

  - stage: coverity
    os: linux
    env: DOCKER_IMAGE=coverity

before_script:
  - source travis/prepare.sh

script:
  - travis/run.sh
